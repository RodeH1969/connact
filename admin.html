<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Connact Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        .login-container h1 {
            color: #007bff;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .login-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        .login-button:hover {
            background: #0056b3;
        }

        .error-message {
            color: #dc3545;
            margin-top: 15px;
            display: none;
        }

        .admin-container {
            display: none;
            width: 100%;
            max-width: 1200px;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: white;
            border-radius: 10px;
            border-bottom: 2px solid #007bff;
        }

        .admin-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .admin-section h3 {
            margin-top: 0;
            color: #007bff;
            font-size: 18px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .admin-input {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .file-upload-zone {
            border: 3px dashed #007bff;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
            margin: 15px 0;
        }

        .file-upload-zone:hover {
            background: #f0f8ff;
            border-color: #0056b3;
        }

        .file-upload-zone.dragover {
            background: #e3f2fd;
            border-color: #1976d2;
        }

        .uploaded-files {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-preview {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
            border: 1px solid #ddd;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .file-type {
            color: #666;
            font-size: 12px;
        }

        .remove-file {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .sequence-builder {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }

        .sequence-step {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
        }

        .step-number {
            background: #007bff;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-weight: bold;
            font-size: 16px;
        }

        .step-content {
            flex: 1;
            display: grid;
            grid-template-columns: 2fr 3fr;
            gap: 15px;
            align-items: center;
        }

        .step-content select, .step-content input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .admin-buttons {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #ddd;
        }

        .admin-buttons button {
            margin: 0 15px;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .save-btn:hover {
            background: #218838;
        }

        .export-btn {
            background: #17a2b8;
            color: white;
        }

        .export-btn:hover {
            background: #138496;
        }

        .logout-btn {
            background: #6c757d;
            color: white;
        }

        .logout-btn:hover {
            background: #5a6268;
        }

        .back-to-game-btn {
            background: #007bff;
            color: white;
        }

        .back-to-game-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginContainer" class="login-container">
        <h1>üîß Admin Access</h1>
        <p>Enter credentials to access the game administration panel</p>
        
        <input type="text" id="username" class="login-input" placeholder="Username" autocomplete="username">
        <input type="password" id="password" class="login-input" placeholder="Password" autocomplete="current-password">
        
        <button class="login-button" onclick="attemptLogin()">Login</button>
        
        <div id="errorMessage" class="error-message">
            Invalid credentials. Please try again.
        </div>
    </div>

    <!-- Admin Panel (Hidden until logged in) -->
    <div id="adminContainer" class="admin-container">
        <div class="admin-header">
            <h1>üîß Game Admin Panel</h1>
            <p>Upload files, set sequence, and customize your game</p>
        </div>
        
        <div class="admin-section">
            <h3>üìÅ Upload PNG Files</h3>
            <div class="file-upload-zone" id="fileUploadZone">
                <input type="file" id="fileInput" multiple accept=".png" style="display: none;">
                <h4>üìé Drag & Drop PNG Files Here</h4>
                <p>Or click to browse for actor and movie images</p>
                <small>Supports multiple file upload</small>
            </div>
            <div id="uploadedFiles" class="uploaded-files" style="display: none;">
                <div id="filesList"></div>
            </div>
        </div>

        <div class="admin-section">
            <h3>üé≠ Choose Anchor Actor</h3>
            <p>Select which actor appears in position 1:</p>
            <select id="anchorSelect" class="admin-input">
                <option value="">Choose anchor actor...</option>
            </select>
        </div>

        <div class="admin-section">
            <h3>üé¨ Build Game Sequence</h3>
            <p>Create the 15-step sequence:</p>
            <div class="sequence-builder">
                <div id="sequenceSteps"></div>
            </div>
            <button class="save-btn" onclick="addSequenceStep()" style="margin: 10px; padding: 10px 20px;">+ Add Step</button>
            <button class="export-btn" onclick="clearSequence()" style="margin: 10px; padding: 10px 20px;">Clear All</button>
        </div>

        <div class="admin-section">
            <h3>‚öôÔ∏è Game Settings</h3>
            <label>SMS Number:</label>
            <input type="text" id="smsNumber" class="admin-input" value="+61459754708">
            
            <label>Logo File:</label>
            <input type="text" id="logoFile" class="admin-input" value="connact_logo.png">
        </div>

        <div class="admin-buttons">
            <button class="save-btn" onclick="saveGameConfig()">üíæ Save & Update Game</button>
            <button class="export-btn" onclick="exportGame()">üì• Export Configuration</button>
            <button class="back-to-game-btn" onclick="backToGame()">üéÆ Back to Game</button>
            <button class="logout-btn" onclick="logout()">üö™ Logout</button>
        </div>
    </div>

    <script>
        // Login credentials (change these for security)
        const ADMIN_USERNAME = "admin";
        const ADMIN_PASSWORD = "connact2025";

        // Game Configuration
        var gameConfig = {
            anchor: {
                name: "Jason Bateman",
                file: "actors/jason_bateman.png"
            },
            sequence: [
                {name: "Identity Thief", file: "movies/identitythief.png", type: "movie"},
                {name: "Melissa McCarthy", file: "actors/Melissa_McCarthy.png", type: "actor"},
                {name: "Bridesmaids", file: "movies/bridesmaids.png", type: "movie"},
                {name: "Rebel Wilson", file: "actors/rebel_wilson.png", type: "actor"},
                {name: "Pitch Perfect", file: "movies/pitchperfect.png", type: "movie"},
                {name: "Anna Kendrick", file: "actors/anna_kendrick.png", type: "actor"},
                {name: "Up in the Air", file: "movies/upintheair.png", type: "movie"},
                {name: "Vera Farmiga", file: "actors/vera_farmiga.png", type: "actor"},
                {name: "The Departed", file: "movies/thedeparted.png", type: "movie"},
                {name: "Mark Wahlberg", file: "actors/mark_wahlberg.png", type: "actor"},
                {name: "Ted", file: "movies/ted.png", type: "movie"},
                {name: "Mila Kunis", file: "actors/mila_kunis.png", type: "actor"},
                {name: "Bad Moms", file: "movies/badmoms.png", type: "movie"},
                {name: "Kristen Bell", file: "actors/kristen_bell.png", type: "actor"},
                {name: "Couples Retreat", file: "movies/couplesretreat.png", type: "movie"}
            ],
            smsNumber: "+61459754708",
            logoFile: "connact_logo.png"
        };

        // Variables
        var uploadedFiles = new Map();

        // Login Functions
        function attemptLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'block';
                document.getElementById('errorMessage').style.display = 'none';
                
                // Load admin data
                loadAdminData();
                console.log('Admin login successful');
            } else {
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('password').value = '';
                console.log('Admin login failed');
            }
        }

        function logout() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('errorMessage').style.display = 'none';
            console.log('Admin logged out');
        }

        function backToGame() {
            window.location.href = 'index.html';
        }

        // Admin Functions
        function loadAdminData() {
            populateAnchorSelect();
            loadSequenceBuilder();
            document.getElementById('smsNumber').value = gameConfig.smsNumber;
            document.getElementById('logoFile').value = gameConfig.logoFile;
            setupFileUpload();
            console.log('Admin data loaded');
        }

        function populateAnchorSelect() {
            var anchorSelect = document.getElementById('anchorSelect');
            anchorSelect.innerHTML = '<option value="">Choose anchor actor...</option>';
            
            var currentAnchor = document.createElement('option');
            currentAnchor.value = gameConfig.anchor.file;
            currentAnchor.textContent = gameConfig.anchor.name;
            currentAnchor.selected = true;
            anchorSelect.appendChild(currentAnchor);
            
            uploadedFiles.forEach(function(fileData, fileName) {
                if (fileData.type === 'actor' && fileData.file !== gameConfig.anchor.file) {
                    var option = document.createElement('option');
                    option.value = fileData.file;
                    option.textContent = fileData.name;
                    anchorSelect.appendChild(option);
                }
            });
            console.log('Anchor select populated');
        }

        function loadSequenceBuilder() {
            var container = document.getElementById('sequenceSteps');
            container.innerHTML = '';
            
            for (var i = 0; i < gameConfig.sequence.length; i++) {
                addSequenceStepWithData(gameConfig.sequence[i], i + 2);
            }
            console.log('Sequence builder loaded');
        }

        function addSequenceStep() {
            var container = document.getElementById('sequenceSteps');
            var stepNumber = container.children.length + 2;
            addSequenceStepWithData(null, stepNumber);
            console.log('Added sequence step', stepNumber);
        }

        function addSequenceStepWithData(data, stepNumber) {
            var container = document.getElementById('sequenceSteps');
            
            var step = document.createElement('div');
            step.className = 'sequence-step';
            
            var isMovieTile = stepNumber % 2 === 0;
            var stepColor = isMovieTile ? '#007bff' : '#28a745';
            
            var stepNumDiv = document.createElement('div');
            stepNumDiv.className = 'step-number';
            stepNumDiv.style.background = stepColor;
            stepNumDiv.textContent = stepNumber;
            
            var stepContent = document.createElement('div');
            stepContent.className = 'step-content';
            
            var nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.placeholder = (isMovieTile ? 'Movie' : 'Actor') + ' Name';
            nameInput.value = data ? data.name : '';
            nameInput.onchange = function() { 
                updateSequenceStep(stepNumber - 2, 'name', this.value); 
            };
            
            var fileSelect = document.createElement('select');
            fileSelect.onchange = function() { 
                updateSequenceStep(stepNumber - 2, 'file', this.value); 
            };
            
            var defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select file...';
            fileSelect.appendChild(defaultOption);
            
            uploadedFiles.forEach(function(fileData, fileName) {
                var option = document.createElement('option');
                option.value = fileData.file;
                option.textContent = fileData.name + ' (' + fileData.type + ')';
                if (data && data.file === fileData.file) {
                    option.selected = true;
                }
                fileSelect.appendChild(option);
            });
            
            stepContent.appendChild(nameInput);
            stepContent.appendChild(fileSelect);
            
            var removeBtn = document.createElement('button');
            removeBtn.className = 'remove-file';
            removeBtn.textContent = 'Remove';
            removeBtn.onclick = function() { 
                removeSequenceStep(stepNumber - 2); 
            };
            
            step.appendChild(stepNumDiv);
            step.appendChild(stepContent);
            step.appendChild(removeBtn);
            
            container.appendChild(step);
        }

        function updateSequenceStep(index, field, value) {
            if (!gameConfig.sequence[index]) {
                gameConfig.sequence[index] = {name: '', file: '', type: ''};
            }
            
            gameConfig.sequence[index][field] = value;
            
            var stepNumber = index + 2;
            gameConfig.sequence[index].type = stepNumber % 2 === 0 ? 'movie' : 'actor';
            console.log('Updated sequence step', index, field, value);
        }

        function removeSequenceStep(index) {
            gameConfig.sequence.splice(index, 1);
            loadSequenceBuilder();
            console.log('Removed sequence step', index);
        }

        function clearSequence() {
            gameConfig.sequence = [];
            loadSequenceBuilder();
            console.log('Sequence cleared');
        }

        function saveGameConfig() {
            var anchorSelect = document.getElementById('anchorSelect');
            if (anchorSelect.value) {
                var selectedFile = anchorSelect.value;
                var selectedOption = anchorSelect.selectedOptions[0];
                gameConfig.anchor = {
                    name: selectedOption.textContent.split(' (')[0],
                    file: selectedFile
                };
            }
            
            gameConfig.smsNumber = document.getElementById('smsNumber').value;
            gameConfig.logoFile = document.getElementById('logoFile').value;
            
            alert('Game configuration saved successfully! Changes will apply to new game sessions.');
            console.log('Game config saved');
        }

        function exportGame() {
            var configJSON = JSON.stringify(gameConfig, null, 2);
            var content = 'Game Configuration:\n\n' + configJSON;
            
            var blob = new Blob([content], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'game-config.json';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Configuration exported successfully!');
            console.log('Game config exported');
        }

        function setupFileUpload() {
            var fileUploadZone = document.getElementById('fileUploadZone');
            var fileInput = document.getElementById('fileInput');

            fileUploadZone.addEventListener('click', function() {
                fileInput.click();
            });

            fileUploadZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                fileUploadZone.classList.add('dragover');
            });

            fileUploadZone.addEventListener('dragleave', function() {
                fileUploadZone.classList.remove('dragover');
            });

            fileUploadZone.addEventListener('drop', function(e) {
                e.preventDefault();
                fileUploadZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
            console.log('File upload setup');
        }

        function handleFiles(files) {
            for (var i = 0; i < files.length; i++) {
                (function(file) {
                    if (file.type === 'image/png') {
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            var fileName = file.name.replace('.png', '');
                            var cleanName = fileName.replace(/_/g, ' ').replace(/\b\w/g, function(l) { 
                                return l.toUpperCase(); 
                            });
                            
                            var type = fileName.toLowerCase().includes('actor') || 
                                      (fileName.includes('_') && !fileName.toLowerCase().includes('movie')) ? 'actor' : 'movie';
                            
                            var fileData = {
                                name: cleanName,
                                file: type + 's/' + file.name,
                                type: type,
                                blob: e.target.result
                            };
                            
                            uploadedFiles.set(file.name, fileData);
                            displayUploadedFiles();
                            populateAnchorSelect();
                        };
                        reader.readAsDataURL(file);
                    }
                })(files[i]);
            }
            console.log('Files handled:', files.length);
        }

        function displayUploadedFiles() {
            var container = document.getElementById('uploadedFiles');
            var filesList = document.getElementById('filesList');
            
            if (uploadedFiles.size === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            filesList.innerHTML = '';
            
            uploadedFiles.forEach(function(fileData, fileName) {
                var fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                var img = document.createElement('img');
                img.src = fileData.blob;
                img.className = 'file-preview';
                img.alt = fileData.name;
                
                var fileInfo = document.createElement('div');
                fileInfo.className = 'file-info';
                
                var fileNameDiv = document.createElement('div');
                fileNameDiv.className = 'file-name';
                fileNameDiv.textContent = fileData.name;
                
                var fileTypeDiv = document.createElement('div');
                fileTypeDiv.className = 'file-type';
                fileTypeDiv.textContent = fileData.type.toUpperCase() + ' ‚Ä¢ ' + fileName;
                
                fileInfo.appendChild(fileNameDiv);
                fileInfo.appendChild(fileTypeDiv);
                
                var removeBtn = document.createElement('button');
                removeBtn.className = 'remove-file';
                removeBtn.textContent = 'Remove';
                removeBtn.onclick = function() { 
                    removeUploadedFile(fileName); 
                };
                
                fileItem.appendChild(img);
                fileItem.appendChild(fileInfo);
                fileItem.appendChild(removeBtn);
                
                filesList.appendChild(fileItem);
            });
            console.log('Uploaded files displayed');
        }

        function removeUploadedFile(fileName) {
            uploadedFiles.delete(fileName);
            displayUploadedFiles();
            populateAnchorSelect();
            console.log('Removed uploaded file', fileName);
        }

        // Handle Enter key for login
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('loginContainer').style.display !== 'none') {
                attemptLogin();
            }
        });

        console.log('Admin panel initialized');
    </script>
</body>
</html>