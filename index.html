<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connact Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background-color: #f5f5f5;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 10px;
        }

        .logo-container img {
            max-width: 200px;
            height: auto;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .circle-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 20px auto;
        }

        .circle-tile, .circle-drop-zone {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #333;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .circle-tile:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        .circle-drop-zone {
            cursor: default;
            border-style: solid;
        }

        .circle-drop-zone.drag-over {
            background-color: #e8f5e8;
            border-color: #4CAF50;
            border-style: dashed;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .circle-drop-zone.start-option {
            border-color: #ffc107;
            background-color: #fff3cd;
            border-width: 4px;
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 4px 8px rgba(255, 193, 7, 0.3); }
            50% { box-shadow: 0 6px 20px rgba(255, 193, 7, 0.8); }
        }

        .circle-tile img, .circle-drop-zone img {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
        }

        .clear-button {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #666;
            z-index: 10;
        }

        .clear-button:hover {
            background: rgba(255, 255, 255, 1);
            color: #333;
        }

        .png-grid {
            display: grid;
            grid-template-columns: repeat(5, 50px);
            grid-template-rows: repeat(3, 50px);
            gap: 8px;
            max-width: 100%;
            margin-top: 20px;
            justify-content: center;
            padding: 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .png-tile {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ccc;
            box-sizing: border-box;
            border-radius: 8px;
            background-color: #fff;
            cursor: grab;
            transition: transform 0.2s, opacity 0.2s, border-color 0.2s;
            touch-action: none;
            user-select: none;
        }

        .png-tile:hover, .png-tile:active {
            transform: scale(1.05);
            border-color: #007bff;
        }

        .png-tile.dragging {
            opacity: 0.3;
            border-color: #28a745;
            transform: scale(0.95);
        }

        .png-tile:active {
            cursor: grabbing;
        }

        .png-tile img {
            width: 46px;
            height: 46px;
            object-fit: cover;
            border-radius: 4px;
        }

        .enter-button {
            display: none;
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
            animation: pulse 1.5s infinite;
        }

        .enter-button:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.4);
        }

        @keyframes pulse {
            0% { box-shadow: 0 2px 8px rgba(0,123,255,0.3); }
            50% { box-shadow: 0 4px 16px rgba(0,123,255,0.6); }
            100% { box-shadow: 0 2px 8px rgba(0,123,255,0.3); }
        }

        .game-info {
            text-align: center;
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
        }

        .game-instructions {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
            font-weight: normal;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.4;
        }

        .message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 10px auto;
            max-width: 600px;
            text-align: center;
        }

        .win-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
        }

        .sms-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .sms-button:hover {
            background: #218838;
        }

        .drop-zone-label {
            color: #666;
            font-weight: bold;
            font-size: 10px;
            text-align: center;
            line-height: 1;
        }

        .start-label {
            color: #ff6b35;
            font-weight: bold;
            font-size: 9px;
            text-align: center;
            line-height: 1;
        }

        /* Mobile Adjustments */
        @media screen and (max-width: 480px) {
            .circle-container {
                width: 320px;
                height: 320px;
            }

            .circle-tile, .circle-drop-zone {
                width: 55px;
                height: 55px;
                border: 2px solid #333;
            }

            .circle-tile img, .circle-drop-zone img {
                width: 51px;
                height: 51px;
            }

            .png-grid {
                grid-template-columns: repeat(5, 40px);
                grid-template-rows: repeat(3, 40px);
                gap: 6px;
            }

            .png-tile {
                width: 40px;
                height: 40px;
                border: 1px solid #ccc;
            }

            .png-tile img {
                width: 38px;
                height: 38px;
            }

            .enter-button {
                padding: 8px 16px;
                font-size: 14px;
            }

            .game-instructions {
                font-size: 14px;
            }

            .drop-zone-label, .start-label {
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img id="gameLogo" src="connact_logo.png" alt="Game Logo" onerror="this.style.display='none';">
    </div>

    <div class="game-info">
        <div class="game-instructions">Complete the circular path by connecting actors through movies. Start with either Identity Thief (clockwise) or Couples Retreat (counterclockwise) to begin your journey back to Jason Bateman!</div>
        <div id="attemptCounter">Attempt 1 of 7</div>
        <div id="gameMessage" class="message" style="display: none;"></div>
        <div id="winMessage" class="win-message" style="display: none;"></div>
    </div>

    <div class="game-container">
        <div class="circle-container" id="circleContainer"></div>
        <button id="enterButton" class="enter-button" onclick="submitMove()" style="display: none;">Enter</button>
        <div class="png-grid" id="pngGrid"></div>
    </div>

    <script>
        // Game Configuration
        var gameConfig = {
            anchor: {
                name: "Jason Bateman",
                file: "actors/jason_bateman.png"
            },
            sequence: [
                {name: "Identity Thief", file: "movies/identitythief.png", type: "movie"},
                {name: "Melissa McCarthy", file: "actors/Melissa_McCarthy.png", type: "actor"},
                {name: "Bridesmaids", file: "movies/bridesmaids.png", type: "movie"},
                {name: "Rebel Wilson", file: "actors/rebel_wilson.png", type: "actor"},
                {name: "Pitch Perfect", file: "movies/pitchperfect.png", type: "movie"},
                {name: "Anna Kendrick", file: "actors/anna_kendrick.png", type: "actor"},
                {name: "Up in the Air", file: "movies/upintheair.png", type: "movie"},
                {name: "Vera Farmiga", file: "actors/vera_farmiga.png", type: "actor"},
                {name: "The Departed", file: "movies/thedeparted.png", type: "movie"},
                {name: "Mark Wahlberg", file: "actors/mark_wahlberg.png", type: "actor"},
                {name: "Ted", file: "movies/ted.png", type: "movie"},
                {name: "Mila Kunis", file: "actors/mila_kunis.png", type: "actor"},
                {name: "Bad Moms", file: "movies/badmoms.png", type: "movie"},
                {name: "Kristen Bell", file: "actors/kristen_bell.png", type: "actor"},
                {name: "Couples Retreat", file: "movies/couplesretreat.png", type: "movie"}
            ],
            smsNumber: "+61459754708",
            logoFile: "connact_logo.png"
        };

        // Variables
        var currentAttempt = 1;
        var maxAttempts = 7;
        var gameWon = false;
        var correctAnswers = {};
        var placedImages = new Map();
        var draggedTile = null;
        var pngTiles = [];
        var isMobile = false;

        function initializeGame() {
            gameWon = false;
            placedImages.clear();
            draggedTile = null;
            
            generateCorrectAnswers();
            createCircularLayout();
            createPngGrid();
            attachEventListeners();
            console.log('Circular layout game initialized');
        }

        function generateCorrectAnswers() {
            correctAnswers = {};
            
            // Position 1: Jason Bateman (anchor) - no answer needed, it's fixed
            // Positions 2-16: The 15 sequence items in order
            for (var i = 0; i < gameConfig.sequence.length; i++) {
                var position = i + 2; // Positions 2-16
                correctAnswers['dropTile' + position] = gameConfig.sequence[i].file;
            }
            
            console.log('=== CIRCULAR LAYOUT MAPPING ===');
            console.log('Position 1: Jason Bateman (anchor)');
            for (var i = 0; i < gameConfig.sequence.length; i++) {
                var pos = i + 2;
                console.log('Position ' + pos + ':', gameConfig.sequence[i].name, '(' + gameConfig.sequence[i].type + ')');
            }
            console.log('Starting options:');
            console.log('  Position 2: Identity Thief (clockwise)');
            console.log('  Position 15: Couples Retreat (counterclockwise)');
            console.log('===============================');
        }

        function createCircularLayout() {
            var circleContainer = document.getElementById('circleContainer');
            circleContainer.innerHTML = '';

            var isMobile = window.innerWidth <= 480;
            var containerSize = isMobile ? 320 : 400;
            var tileSize = isMobile ? 55 : 70;
            var radius = (containerSize - tileSize) / 2;
            var centerX = containerSize / 2;
            var centerY = containerSize / 2;

            // Create 16 positions in a circle
            for (var pos = 1; pos <= 16; pos++) {
                // Calculate angle for this position (starting from top, going clockwise)
                var angle = ((pos - 1) * 22.5 - 90) * (Math.PI / 180); // -90 to start at top
                
                // Calculate position
                var x = centerX + radius * Math.cos(angle) - tileSize / 2;
                var y = centerY + radius * Math.sin(angle) - tileSize / 2;

                if (pos === 1) {
                    // Jason Bateman at position 1
                    var anchorTile = document.createElement('div');
                    anchorTile.className = 'circle-tile';
                    anchorTile.style.left = x + 'px';
                    anchorTile.style.top = y + 'px';
                    anchorTile.setAttribute('data-src', gameConfig.anchor.file);
                    anchorTile.setAttribute('data-name', gameConfig.anchor.name);

                    var img = document.createElement('img');
                    img.src = gameConfig.anchor.file;
                    img.alt = gameConfig.anchor.name;
                    img.onerror = function() {
                        anchorTile.innerHTML = '<div style="padding:2px; text-align:center; color:#999; font-size:10px;">' + gameConfig.anchor.name + '</div>';
                    };

                    anchorTile.appendChild(img);
                    circleContainer.appendChild(anchorTile);
                    
                } else {
                    // Create drop zones for positions 2-16
                    var dropZone = document.createElement('div');
                    dropZone.className = 'circle-drop-zone';
                    dropZone.id = 'dropTile' + pos;
                    dropZone.style.left = x + 'px';
                    dropZone.style.top = y + 'px';
                    
                    // Mark starting positions
                    if (pos === 2 || pos === 15) {
                        dropZone.classList.add('start-option');
                    }
                    
                    // Determine if it's movie or actor based on sequence index
                    var sequenceIndex = pos - 2; // Convert position to sequence index (0-14)
                    if (sequenceIndex >= 0 && sequenceIndex < gameConfig.sequence.length) {
                        var item = gameConfig.sequence[sequenceIndex];
                        var isMovie = item.type === 'movie';
                        var color = isMovie ? '#007bff' : '#28a745';
                        var label = isMovie ? 'Movie' : 'Actor';
                        
                        if (pos === 2) {
                            dropZone.innerHTML = '<div class="start-label">START<br>' + label + '</div>';
                        } else if (pos === 15) {
                            dropZone.innerHTML = '<div class="start-label">START<br>' + label + '</div>';
                        } else {
                            dropZone.innerHTML = '<div class="drop-zone-label" style="color: ' + color + ';">' + label + '</div>';
                        }
                    }
                    
                    circleContainer.appendChild(dropZone);
                }
            }
            
            console.log('Circular layout created with 16 positions');
        }

        function createPngGrid() {
            var pngGrid = document.getElementById('pngGrid');
            pngGrid.innerHTML = '';
            pngTiles = [];

            var allImages = gameConfig.sequence.slice();
            
            // Shuffle the array
            for (var i = allImages.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = allImages[i];
                allImages[i] = allImages[j];
                allImages[j] = temp;
            }

            console.log('=== PNG TILES CREATED ===');
            for (var i = 0; i < allImages.length; i++) {
                var item = allImages[i];
                var tile = document.createElement('div');
                tile.className = 'png-tile';
                tile.setAttribute('draggable', 'true');
                tile.setAttribute('data-src', item.file);
                tile.setAttribute('data-name', item.name);
                pngTiles.push(tile);

                console.log('PNG Tile:', item.name, '→', item.file);

                var img = document.createElement('img');
                img.src = item.file;
                img.alt = item.name;
                img.onerror = function() {
                    this.parentNode.innerHTML = '<div style="padding:2px; text-align:center; color:#999; font-size:8px;">' + this.alt + '</div>';
                };

                tile.appendChild(img);
                pngGrid.appendChild(tile);
            }
            console.log('========================');
        }

        function attachEventListeners() {
            var imageElements = document.querySelectorAll('.png-tile');
            
            isMobile = window.innerWidth <= 768 || 'ontouchstart' in window;

            for (var i = 0; i < imageElements.length; i++) {
                if (isMobile) {
                    // Mobile: Simple tap to place
                    imageElements[i].addEventListener('touchstart', function(e) {
                        if (gameWon) return;
                        e.preventDefault();
                        
                        var imageSrc = this.getAttribute('data-src');
                        var imageName = this.getAttribute('data-name');
                        
                        // Find a valid drop zone for this image
                        var validDropZone = findValidDropZone(imageSrc);
                        if (validDropZone) {
                            draggedTile = this;
                            this.style.opacity = '0.3';
                            validDropZone.style.backgroundColor = '#fff3cd';
                            validDropZone.style.borderColor = '#ffc107';
                            validDropZone.classList.add('drag-over');
                            
                            var enterButton = document.getElementById('enterButton');
                            enterButton.style.display = 'block';
                            enterButton.style.backgroundColor = '#28a745';
                            enterButton.textContent = 'Submit "' + imageName + '"';
                            
                            console.log('Mobile tap - ready to submit:', imageName, 'to', validDropZone.id);
                        }
                    });
                } else {
                    // Desktop: Drag and drop
                    imageElements[i].addEventListener('dragstart', function(e) {
                        if (gameWon) return;
                        
                        draggedTile = this;
                        var imgSrc = this.getAttribute('data-src');
                        var imgName = this.getAttribute('data-name');
                        e.dataTransfer.setData('text/plain', imgSrc);
                        e.dataTransfer.setData('text/name', imgName);
                        e.dataTransfer.effectAllowed = 'move';
                        this.classList.add('dragging');
                        console.log('Drag started on', imgName);
                    });

                    imageElements[i].addEventListener('dragend', function(e) {
                        this.classList.remove('dragging');
                        console.log('Drag ended');
                    });
                }
            }

            // Attach listeners to all drop zones
            attachDropZoneListeners();
        }

        function findValidDropZone(imageSrc) {
            // Find a drop zone that accepts this image and is empty
            for (var pos = 2; pos <= 16; pos++) {
                var dropZoneId = 'dropTile' + pos;
                var dropZone = document.getElementById(dropZoneId);
                
                if (dropZone && !dropZone.querySelector('img') && correctAnswers[dropZoneId] === imageSrc) {
                    return dropZone;
                }
            }
            return null;
        }

        function attachDropZoneListeners() {
            var dropZones = document.querySelectorAll('.circle-drop-zone');
            
            for (var i = 0; i < dropZones.length; i++) {
                // Remove existing listeners by cloning the element
                var newDropZone = dropZones[i].cloneNode(true);
                dropZones[i].parentNode.replaceChild(newDropZone, dropZones[i]);
                
                // Add fresh event listeners
                newDropZone.addEventListener('dragover', function(e) {
                    if (gameWon) return;
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    // Remove drag-over from all other zones
                    var allZones = document.querySelectorAll('.circle-drop-zone');
                    for (var j = 0; j < allZones.length; j++) {
                        allZones[j].classList.remove('drag-over');
                    }
                    
                    this.classList.add('drag-over');
                    document.getElementById('enterButton').style.display = 'block';
                    console.log('Drag over', this.id);
                });
                
                newDropZone.addEventListener('dragleave', function(e) {
                    var rect = this.getBoundingClientRect();
                    var x = e.clientX;
                    var y = e.clientY;
                    
                    if (x < rect.left || x > rect.right || y < rect.top || y > rect.bottom) {
                        this.classList.remove('drag-over');
                        if (!document.querySelector('.circle-drop-zone.drag-over')) {
                            document.getElementById('enterButton').style.display = 'none';
                        }
                    }
                });
                
                newDropZone.addEventListener('drop', function(e) {
                    if (gameWon) return;
                    
                    e.preventDefault();
                    
                    var imageSrc = e.dataTransfer.getData('text/plain');
                    var imageName = e.dataTransfer.getData('text/name');
                    
                    if (imageSrc && !this.querySelector('img') && draggedTile) {
                        draggedTile.style.opacity = '0.3';
                        this.style.backgroundColor = '#fff3cd';
                        this.style.borderColor = '#ffc107';
                        
                        var enterButton = document.getElementById('enterButton');
                        enterButton.style.display = 'block';
                        enterButton.style.backgroundColor = '#28a745';
                        enterButton.textContent = 'Submit "' + imageName + '"';
                        
                        console.log('Ready to submit:', imageName, 'to', this.id);
                    }
                });
            }
        }

        function submitMove() {
            if (!draggedTile) {
                console.log('No dragged tile');
                return;
            }

            var dropZone = document.querySelector('.circle-drop-zone.drag-over');
            if (!dropZone) {
                console.log('No drop zone with drag-over class');
                return;
            }

            var imageSrc = draggedTile.getAttribute('data-src');
            var imageName = draggedTile.getAttribute('data-name');
            var correctImage = correctAnswers[dropZone.id];

            console.log('=== SUBMIT MOVE DEBUG ===');
            console.log('Drop Zone:', dropZone.id);
            console.log('Player dragged:', imageName, '→', imageSrc);
            console.log('Expected:', correctImage);
            console.log('Match:', imageSrc === correctImage);
            console.log('========================');
            
            if (imageSrc === correctImage) {
                // Correct move
                placeImageInCircle(dropZone, imageSrc, imageName);
                draggedTile.parentNode.removeChild(draggedTile);
                draggedTile = null;
                
                // Clear visual feedback
                dropZone.classList.remove('drag-over', 'start-option');
                dropZone.style.backgroundColor = '';
                dropZone.style.borderColor = '';
                document.getElementById('enterButton').style.display = 'none';
                document.getElementById('gameMessage').style.display = 'none';
                
                checkIfAllTilesFilled();
                console.log('✅ CORRECT! Tiles placed:', placedImages.size);
            } else {
                // Incorrect move - return tile to PNG area
                dropZone.classList.remove('drag-over');
                dropZone.style.backgroundColor = '';
                dropZone.style.borderColor = '';
                draggedTile.style.opacity = '1';
                
                var remainingAttempts = maxAttempts - currentAttempt;
                document.getElementById('gameMessage').innerHTML = '❌ Wrong! You have ' + remainingAttempts + ' attempts remaining.';
                document.getElementById('gameMessage').style.display = 'block';
                document.getElementById('gameMessage').style.background = '#f8d7da';
                document.getElementById('gameMessage').style.borderColor = '#f5c6cb';
                document.getElementById('gameMessage').style.color = '#721c24';
                
                document.getElementById('enterButton').style.display = 'none';
                draggedTile = null;
                
                if (currentAttempt < maxAttempts) {
                    currentAttempt++;
                    document.getElementById('attemptCounter').textContent = 'Attempt ' + currentAttempt + ' of ' + maxAttempts;
                } else {
                    // Game over
                    document.getElementById('gameMessage').innerHTML = 'Game Over! You have used all ' + maxAttempts + ' attempts.';
                    gameWon = true; // Prevent further interactions
                }
                console.log('❌ INCORRECT! Attempt', currentAttempt);
            }
        }

        function placeImageInCircle(dropZone, imageSrc, imageName) {
            var position = dropZone.style;
            
            dropZone.innerHTML = '';
            dropZone.style.left = position.left;
            dropZone.style.top = position.top;
            
            placedImages.set(dropZone.id, {src: imageSrc, name: imageName});
            
            var img = document.createElement('img');
            img.src = imageSrc;
            img.alt = imageName;
            
            img.onerror = function() {
                dropZone.innerHTML = '<div style="padding:4px; color:#999; font-size:8px; text-align:center;">' + imageName + '<br><small>(Image not found)</small></div>';
                dropZone.style.left = position.left;
                dropZone.style.top = position.top;
            };
            
            var clearButton = document.createElement('div');
            clearButton.className = 'clear-button';
            clearButton.innerHTML = '×';
            clearButton.title = 'Clear image';
            clearButton.addEventListener('click', function() { 
                clearCircleTile(dropZone); 
            });
            
            dropZone.appendChild(img);
            dropZone.appendChild(clearButton);
            console.log('Image placed in circle', dropZone.id);
        }

        function clearCircleTile(tile) {
            var position = tile.style;
            
            // Get the position number from tile ID
            var positionNum = parseInt(tile.id.replace('dropTile', ''));
            var sequenceIndex = positionNum - 2;
            
            // Restore original drop zone appearance
            if (positionNum === 2 || positionNum === 15) {
                tile.classList.add('start-option');
            }
            
            if (sequenceIndex >= 0 && sequenceIndex < gameConfig.sequence.length) {
                var item = gameConfig.sequence[sequenceIndex];
                var isMovie = item.type === 'movie';
                var color = isMovie ? '#007bff' : '#28a745';
                var label = isMovie ? 'Movie' : 'Actor';
                
                if (positionNum === 2) {
                    tile.innerHTML = '<div class="start-label">START<br>' + label + '</div>';
                } else if (positionNum === 15) {
                    tile.innerHTML = '<div class="start-label">START<br>' + label + '</div>';
                } else {
                    tile.innerHTML = '<div class="drop-zone-label" style="color: ' + color + ';">' + label + '</div>';
                }
            } else {
                tile.innerHTML = '';
            }
            
            tile.style.backgroundColor = '';
            tile.style.borderColor = '';
            tile.style.left = position.left;
            tile.style.top = position.top;
            
            placedImages.delete(tile.id);
            
            attachDropZoneListeners();
            checkIfAllTilesFilled();
            console.log('Circle tile cleared', tile.id);
        }

        function checkIfAllTilesFilled() {
            var totalTiles = Object.keys(correctAnswers).length;
            var filledTiles = placedImages.size;
            
            if (filledTiles === totalTiles) {
                gameWon = true;
                showWinMessage();
            }
            console.log('Checked tiles:', filledTiles, '/', totalTiles);
        }

        function showWinMessage() {
            var sequenceNames = [];
            for (var i = 0; i < gameConfig.sequence.length; i++) {
                sequenceNames.push(gameConfig.sequence[i].name);
            }
            var progression = gameConfig.anchor.name + ' → ' + sequenceNames.join(' → ') + ' → ' + gameConfig.anchor.name;
            var winMessage = document.getElementById('winMessage');
            var gameMessage = document.getElementById('gameMessage');
            
            gameMessage.style.display = 'none';
            
            winMessage.innerHTML = '<h2>🎉 Circle Complete! 🎉</h2><p><strong>Connact Game ' + currentAttempt + '/7</strong></p><p>' + progression + '</p><button class="sms-button" onclick="sendSMS()">Share Results</button>';
            winMessage.style.display = 'block';
            
            document.getElementById('attemptCounter').textContent = 'Completed in ' + currentAttempt + (currentAttempt === 1 ? ' attempt!' : ' attempts!');
            console.log('Win message shown');
        }
        
        function sendSMS() {
            var sequenceNames = [];
            for (var i = 0; i < gameConfig.sequence.length; i++) {
                sequenceNames.push(gameConfig.sequence[i].name);
            }
            var progression = gameConfig.anchor.name + ' → ' + sequenceNames.join(' → ') + ' → ' + gameConfig.anchor.name;
            var attemptsText = currentAttempt === 1 ? "1 attempt" : currentAttempt + " attempts";
            var message = 'Connact Game ' + currentAttempt + '/7\n\n' + progression + '\n\nCompleted in ' + attemptsText + '!';
            
            var smsURL = 'sms:' + gameConfig.smsNumber + '?body=' + encodeURIComponent(message);
            window.open(smsURL, '_blank');
            console.log('SMS sent');
        }

        function resetDragState() {
            var draggingTiles = document.querySelectorAll('.png-tile.dragging');
            for (var i = 0; i < draggingTiles.length; i++) {
                draggingTiles[i].classList.remove('dragging');
                draggingTiles[i].style.opacity = '1';
            }
            
            var dragOverZones = document.querySelectorAll('.circle-drop-zone.drag-over');
            for (var i = 0; i < dragOverZones.length; i++) {
                dragOverZones[i].classList.remove('drag-over');
                dragOverZones[i].style.backgroundColor = '';
                dragOverZones[i].style.borderColor = '';
            }
            
            var enterButton = document.getElementById('enterButton');
            enterButton.style.display = 'none';
            enterButton.textContent = 'Enter';
            enterButton.style.backgroundColor = '#007bff';
            
            draggedTile = null;
            console.log('Drag state reset');
        }

        window.addEventListener('dragend', function(e) {
            if (e.target.classList.contains('png-tile')) {
                setTimeout(function() {
                    if (!document.querySelector('.circle-drop-zone.drag-over')) {
                        resetDragState();
                    }
                }, 100);
            }
        });

        // Handle window resize to recreate layout
        window.addEventListener('resize', function() {
            createCircularLayout();
            attachDropZoneListeners();
        });

        window.addEventListener('load', function() {
            try {
                initializeGame();
                console.log('Circular game initialized successfully');
            } catch (error) {
                console.error('Error initializing game:', error);
            }
        });
    </script>
</body>
</html>