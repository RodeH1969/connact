<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connact Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            background-color: #f5f5f5;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .circle-container {
            position: relative;
            width: 400px;
            height: 400px;
            margin: 20px auto;
        }

        .center-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 160px;
            height: 160px;
            z-index: 0;
            background-color: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .center-logo img {
            width: 140px;
            height: 140px;
            object-fit: contain;
        }

        .circle-tile, .circle-drop-zone {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px solid #333;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            box-sizing: border-box;
            z-index: 2;
        }

        .circle-tile:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        .circle-drop-zone {
            cursor: default;
            border-style: solid;
        }

        .circle-drop-zone.mobile-pulse {
            animation: mobilePulse 1.5s infinite;
            border-color: #28a745;
            border-width: 4px;
        }

        @keyframes mobilePulse {
            0%, 100% { 
                box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 6px 20px rgba(40, 167, 69, 0.8);
                transform: scale(1.05);
            }
        }

        .mobile-selected {
            border-color: #28a745 !important;
            border-width: 4px !important;
            transform: scale(1.1) !important;
            box-shadow: 0 6px 16px rgba(40, 167, 69, 0.6) !important;
        }

        .mobile-instruction {
            background: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin: 10px auto;
            max-width: 350px;
            display: none;
            animation: fadeInBounce 0.5s ease;
        }

        @keyframes fadeInBounce {
            0% { opacity: 0; transform: translateY(-10px) scale(0.9); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        @media screen and (min-width: 769px) {
            .mobile-instruction {
                display: none !important;
            }
        }

        .circle-tile img, .circle-drop-zone img {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
        }

        .clear-button {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: #666;
            z-index: 10;
        }

        .clear-button:hover {
            background: rgba(255, 255, 255, 1);
            color: #333;
        }

        .png-grid {
            display: grid;
            grid-template-columns: repeat(5, 50px);
            grid-template-rows: repeat(3, 50px);
            gap: 8px;
            max-width: 100%;
            margin-top: 20px;
            justify-content: center;
            padding: 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .png-tile {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ccc;
            box-sizing: border-box;
            border-radius: 8px;
            background-color: #fff;
            cursor: grab;
            transition: transform 0.2s, opacity 0.2s, border-color 0.2s;
            touch-action: none;
            user-select: none;
        }

        .png-tile:hover, .png-tile:active {
            transform: scale(1.05);
            border-color: #007bff;
        }

        .png-tile.dragging {
            opacity: 0.3;
            border-color: #28a745;
            transform: scale(0.95);
        }

        .png-tile:active {
            cursor: grabbing;
        }

        .png-tile img {
            width: 46px;
            height: 46px;
            object-fit: cover;
            border-radius: 4px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
        }

        .png-tile img[src=""], .png-tile img:not([src]) {
            background-color: #e9ecef;
            border: 2px dashed #adb5bd;
        }

        .enter-button {
            display: none;
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,123,255,0.3);
            animation: pulse 1.5s infinite;
        }

        .enter-button:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.4);
        }

        @keyframes pulse {
            0% { box-shadow: 0 2px 8px rgba(0,123,255,0.3); }
            50% { box-shadow: 0 4px 16px rgba(0,123,255,0.6); }
            100% { box-shadow: 0 2px 8px rgba(0,123,255,0.3); }
        }

        .game-info {
            text-align: center;
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
        }

        .game-instructions {
            font-size: 16px;
            color: #007bff;
            margin-bottom: 15px;
            font-weight: bold;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.4;
        }

        .message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 10px auto;
            max-width: 600px;
            text-align: center;
        }

        .win-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 20px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
        }

        .sms-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .sms-button:hover {
            background: #218838;
        }

        .drop-zone-label {
            color: #666;
            font-weight: bold;
            font-size: 10px;
            text-align: center;
            line-height: 1;
        }

        @media screen and (max-width: 480px) {
            .circle-container {
                width: 320px;
                height: 320px;
            }

            .center-logo {
                width: 240px;
                height: 240px;
            }

            .center-logo img {
                width: 200px;
                height: 200px;
            }

            .circle-tile, .circle-drop-zone {
                width: 55px;
                height: 55px;
                border: 2px solid #333;
            }

            .circle-tile img, .circle-drop-zone img {
                width: 51px;
                height: 51px;
            }

            .png-grid {
                grid-template-columns: repeat(5, 40px);
                grid-template-rows: repeat(3, 40px);
                gap: 6px;
            }

            .png-tile {
                width: 40px;
                height: 40px;
                border: 1px solid #ccc;
            }

            .png-tile img {
                width: 38px;
                height: 38px;
            }

            .enter-button {
                padding: 8px 16px;
                font-size: 14px;
            }

            .game-instructions {
                font-size: 14px;
            }

            .drop-zone-label {
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="game-info">
        <div class="game-instructions"><strong>Connect actors through movies!</strong><br><strong>Place each image in its correct tile.</strong></div>
        <div id="attemptCounter">Attempt 1 of 7</div>
        <div id="mobileInstruction" class="mobile-instruction"></div>
        <div id="gameMessage" class="message" style="display: none;"></div>
        <div id="winMessage" class="win-message" style="display: none;"></div>
    </div>

    <div class="game-container">
        <div class="circle-container" id="circleContainer"></div>
        <button id="enterButton" class="enter-button" onclick="submitMove()" style="display: none;">Enter</button>
        <div class="png-grid" id="pngGrid"></div>
    </div>

    <script>
        // Game Configuration
        var gameConfig = {
            anchor: {
                name: "Jason Bateman",
                file: "actors/jason_bateman.png"
            },
            sequence: [
                {name: "Identity Thief", file: "movies/identitythief.png", type: "movie"},
                {name: "Melissa McCarthy", file: "actors/melissa_mccarthy.png", type: "actor"},
                {name: "Bridesmaids", file: "movies/bridesmaids.png", type: "movie"},
                {name: "Rebel Wilson", file: "actors/rebel_wilson.png", type: "actor"},
                {name: "Pitch Perfect", file: "movies/pitchperfect.png", type: "movie"},
                {name: "Anna Kendrick", file: "actors/anna_kendrick.png", type: "actor"},
                {name: "Up in the Air", file: "movies/upintheair.png", type: "movie"},
                {name: "Vera Farmiga", file: "actors/vera_farmiga.png", type: "actor"},
                {name: "The Departed", file: "movies/thedeparted.png", type: "movie"},
                {name: "Mark Wahlberg", file: "actors/mark_wahlberg.png", type: "actor"},
                {name: "Ted", file: "movies/ted.png", type: "movie"},
                {name: "Mila Kunis", file: "actors/mila_kunis.png", type: "actor"},
                {name: "Bad Moms", file: "movies/badmoms.png", type: "movie"},
                {name: "Kristen Bell", file: "actors/kristen_bell.png", type: "actor"},
                {name: "Couples Retreat", file: "movies/couplesretreat.png", type: "movie"}
            ],
            smsNumber: "+61459754708",
            logoFile: "connact_logo.png"
        };

        // Variables
        var currentAttempt = 1;
        var maxAttempts = 7;
        var gameWon = false;
        var correctAnswers = {};
        var placedImages = new Map();
        var draggedTile = null;
        var pngTiles = [];
        var isMobile = false;
        var selectedTile = null;

        function initializeGame() {
            gameWon = false;
            placedImages.clear();
            draggedTile = null;
            selectedTile = null;
            generateCorrectAnswers();
            createCircularLayout();
            createPngGrid();
            attachEventListeners();
            console.log('Game initialized with fixed tile assignments');
        }

        function generateCorrectAnswers() {
            correctAnswers = {
                'dropTile2': ['movies/identitythief.png'],
                'dropTile3': ['actors/melissa_mccarthy.png'],
                'dropTile4': ['movies/bridesmaids.png'],
                'dropTile5': ['actors/rebel_wilson.png'],
                'dropTile6': ['movies/pitchperfect.png'],
                'dropTile7': ['actors/anna_kendrick.png'],
                'dropTile8': ['movies/upintheair.png'],
                'dropTile10': ['movies/thedeparted.png'],
                'dropTile11': ['actors/mark_wahlberg.png'],
                'dropTile12': ['movies/ted.png'],
                'dropTile13': ['actors/mila_kunis.png'],
                'dropTile14': ['movies/badmoms.png'],
                'dropTile15': ['actors/kristen_bell.png'],
                'dropTile16': ['movies/couplesretreat.png']
            };
            console.log('=== FIXED TILE ASSIGNMENTS ===');
            for (var tile in correctAnswers) {
                console.log(`${tile}: ${correctAnswers[tile]}`);
            }
            console.log('==============================');
        }

        function createCircularLayout() {
            var circleContainer = document.getElementById('circleContainer');
            circleContainer.innerHTML = '';

            var isMobile = window.innerWidth <= 480;
            var containerSize = isMobile ? 320 : 400;
            var tileSize = isMobile ? 55 : 70;
            var radius = (containerSize - tileSize) / 2;
            var centerX = containerSize / 2;
            var centerY = containerSize / 2;

            var centerLogo = document.createElement('div');
            centerLogo.className = 'center-logo';
            var logoImg = document.createElement('img');
            logoImg.src = 'connact_logo.png';
            logoImg.alt = 'Connact Logo';
            logoImg.onerror = function() { 
                centerLogo.style.display = 'none'; 
                console.log('Logo image not found');
            };
            centerLogo.appendChild(logoImg);
            circleContainer.appendChild(centerLogo);

            for (var pos = 1; pos <= 16; pos++) {
                var angle = ((pos - 1) * 22.5 - 90) * (Math.PI / 180);
                var x = centerX + radius * Math.cos(angle) - tileSize / 2;
                var y = centerY + radius * Math.sin(angle) - tileSize / 2;

                if (pos === 1) {
                    var anchorTile = document.createElement('div');
                    anchorTile.className = 'circle-tile';
                    anchorTile.style.left = x + 'px';
                    anchorTile.style.top = y + 'px';
                    anchorTile.setAttribute('data-src', gameConfig.anchor.file);
                    anchorTile.setAttribute('data-name', gameConfig.anchor.name);

                    var img = document.createElement('img');
                    img.src = gameConfig.anchor.file;
                    img.alt = gameConfig.anchor.name;
                    img.onerror = function() {
                        anchorTile.innerHTML = '<div style="padding:2px; text-align:center; color:#999; font-size:10px;">' + gameConfig.anchor.name + '</div>';
                    };

                    anchorTile.appendChild(img);
                    circleContainer.appendChild(anchorTile);
                } else if (pos === 9) {
                    var secondAnchorTile = document.createElement('div');
                    secondAnchorTile.className = 'circle-tile';
                    secondAnchorTile.style.left = x + 'px';
                    secondAnchorTile.style.top = y + 'px';
                    secondAnchorTile.setAttribute('data-src', 'actors/vera_farmiga.png');
                    secondAnchorTile.setAttribute('data-name', 'Vera Farmiga');

                    var img = document.createElement('img');
                    img.src = 'actors/vera_farmiga.png';
                    img.alt = 'Vera Farmiga';
                    img.onerror = function() {
                        secondAnchorTile.innerHTML = '<div style="padding:2px; text-align:center; color:#999; font-size:10px;">Vera Farmiga</div>';
                    };

                    secondAnchorTile.appendChild(img);
                    circleContainer.appendChild(secondAnchorTile);
                } else {
                    var dropZone = document.createElement('div');
                    dropZone.className = 'circle-drop-zone';
                    dropZone.id = 'dropTile' + pos;
                    dropZone.style.left = x + 'px';
                    dropZone.style.top = y + 'px';
                    var sequenceIndex = pos - 2;
                    if (sequenceIndex >= 0 && sequenceIndex < gameConfig.sequence.length) {
                        var item = gameConfig.sequence[sequenceIndex];
                        var isMovie = item.type === 'movie';
                        var color = isMovie ? '#007bff' : '#28a745';
                        var label = isMovie ? 'Movie' : 'Actor';
                        dropZone.innerHTML = '<div class="drop-zone-label" style="color: ' + color + ';">' + label + '</div>';
                    }
                    circleContainer.appendChild(dropZone);
                }
            }
            console.log('Circular layout created with 16 positions, including anchors at 1 and 9');
        }

        function createPngGrid() {
            var pngGrid = document.getElementById('pngGrid');
            pngGrid.innerHTML = '';
            pngTiles = [];

            var allImages = gameConfig.sequence.slice();
            // Remove Vera Farmiga from available PNG files
            allImages = allImages.filter(item => item.name !== "Vera Farmiga");

            for (var i = allImages.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = allImages[i];
                allImages[i] = allImages[j];
                allImages[j] = temp;
            }

            console.log('=== PNG TILES CREATED ===');
            for (var i = 0; i < allImages.length; i++) {
                var item = allImages[i];
                var tile = document.createElement('div');
                tile.className = 'png-tile';
                tile.setAttribute('draggable', 'true');
                tile.setAttribute('data-src', item.file);
                tile.setAttribute('data-name', item.name);
                pngTiles.push(tile);

                console.log('PNG Tile:', item.name, '→', item.file);

                var img = document.createElement('img');
                img.src = item.file;
                img.alt = item.name;
                img.onerror = function() {
                    this.parentNode.innerHTML = '<div style="padding:8px; text-align:center; color:#666; font-size:10px; background:#f8f9fa; border-radius:4px; border:1px solid #ddd;">' + this.alt + '</div>';
                };

                img.loading = 'lazy';
                tile.appendChild(img);
                pngGrid.appendChild(tile);
            }
            console.log('========================');
        }

        function attachEventListeners() {
            var imageElements = document.querySelectorAll('.png-tile');
            isMobile = window.innerWidth <= 768 || 'ontouchstart' in window;

            for (var i = 0; i < imageElements.length; i++) {
                if (isMobile) {
                    imageElements[i].addEventListener('touchstart', function(e) {
                        if (gameWon) return;
                        e.preventDefault();
                        clearMobileSelection();
                        selectedTile = this;
                        this.classList.add('mobile-selected');
                        var imageName = this.getAttribute('data-name');
                        var instruction = document.getElementById('mobileInstruction');
                        instruction.textContent = 'NOW TAP A CIRCLE TO PLACE ' + imageName.toUpperCase();
                        instruction.style.display = 'block';
                        var emptyCircles = document.querySelectorAll('.circle-drop-zone');
                        for (var j = 0; j < emptyCircles.length; j++) {
                            if (!emptyCircles[j].querySelector('img')) {
                                emptyCircles[j].classList.add('mobile-pulse');
                            }
                        }
                        console.log('Mobile: Selected', imageName, '- circles now pulsing');
                    });
                } else {
                    imageElements[i].addEventListener('dragstart', function(e) {
                        if (gameWon) return;
                        draggedTile = this;
                        var imgSrc = this.getAttribute('data-src');
                        var imgName = this.getAttribute('data-name');
                        e.dataTransfer.setData('text/plain', imgSrc);
                        e.dataTransfer.setData('text/name', imgName);
                        e.dataTransfer.effectAllowed = 'move';
                        this.classList.add('dragging');
                        console.log('Drag started on', imgName);
                    });

                    imageElements[i].addEventListener('dragend', function(e) {
                        this.classList.remove('dragging');
                        console.log('Drag ended');
                    });
                }
            }
            attachDropZoneListeners();
        }

        function clearMobileSelection() {
            var pngTiles = document.querySelectorAll('.png-tile');
            for (var i = 0; i < pngTiles.length; i++) {
                pngTiles[i].classList.remove('mobile-selected');
            }
            var circles = document.querySelectorAll('.circle-drop-zone');
            for (var i = 0; i < circles.length; i++) {
                circles[i].classList.remove('mobile-pulse');
            }
            var instruction = document.getElementById('mobileInstruction');
            instruction.style.display = 'none';
            selectedTile = null;
            console.log('Mobile: Selection cleared - placedImages:', [...placedImages]);
        }

        function validateMove(imageSrc, dropZoneId, position) {
            console.log('Validate Move:', { imageSrc, dropZoneId, position, correctAnswers });
            console.log('placedImages:', [...placedImages]);
            let isCorrect = false;
            const correctImage = correctAnswers[dropZoneId];
            isCorrect = correctImage.includes(imageSrc);
            console.log('Comparing:', { imageSrc, correctImage });
            console.log('Validation Result:', isCorrect);
            if (!isCorrect && placedImages.size > 0) {
                console.log('Incorrect move, but allowing flexibility');
            }
            return isCorrect;
        }

        function updateCorrectAnswers(startingImage, startPosition) {
            // No directional logic; fixed assignments already set in generateCorrectAnswers
            console.log('Update skipped, using fixed tile assignments');
        }

        function checkIfAllTilesFilled() {
            var totalTiles = Object.keys(correctAnswers).length;
            var filledTiles = placedImages.size;
            if (filledTiles === totalTiles) {
                gameWon = true;
                showWinMessage();
            }
            console.log('Checked tiles:', filledTiles, '/', totalTiles);
        }

        function showWinMessage() {
            var sequenceNames = [];
            for (var i = 0; i < gameConfig.sequence.length; i++) {
                sequenceNames.push(gameConfig.sequence[i].name);
            }
            var progression = gameConfig.anchor.name + ' → ' + sequenceNames.join(' → ') + ' → ' + gameConfig.anchor.name;
            var winMessage = document.getElementById('winMessage');
            var gameMessage = document.getElementById('gameMessage');
            gameMessage.style.display = 'none';
            winMessage.innerHTML = '<h2>🎉 Circle Complete! 🎉</h2><p><strong>Connact Game ' + currentAttempt + '/7</strong></p><p>' + progression + '</p><button class="sms-button" onclick="sendSMS()">Share Results</button>';
            winMessage.style.display = 'block';
            document.getElementById('attemptCounter').textContent = 'Completed in ' + currentAttempt + (currentAttempt === 1 ? ' attempt!' : ' attempts!');
            console.log('Win message shown');
        }

        function sendSMS() {
            var sequenceNames = [];
            for (var i = 0; i < gameConfig.sequence.length; i++) {
                sequenceNames.push(gameConfig.sequence[i].name);
            }
            var progression = gameConfig.anchor.name + ' → ' + sequenceNames.join(' → ') + ' → ' + gameConfig.anchor.name;
            var attemptsText = currentAttempt === 1 ? "1 attempt" : currentAttempt + " attempts";
            var message = 'Connact Game ' + currentAttempt + '/7\n\n' + progression + '\n\nCompleted in ' + attemptsText + '!';
            var smsURL = 'sms:' + gameConfig.smsNumber + '?body=' + encodeURIComponent(message);
            window.open(smsURL, '_blank');
            console.log('SMS sent');
        }

        function resetDragState() {
            if (isMobile) {
                clearMobileSelection();
            } else {
                var draggingTiles = document.querySelectorAll('.png-tile.dragging');
                for (var i = 0; i < draggingTiles.length; i++) {
                    draggingTiles[i].classList.remove('dragging');
                    draggingTiles[i].style.opacity = '1';
                }
                var dragOverZones = document.querySelectorAll('.circle-drop-zone.drag-over');
                for (var i = 0; i < dragOverZones.length; i++) {
                    dragOverZones[i].classList.remove('drag-over');
                    dragOverZones[i].style.backgroundColor = '';
                    dragOverZones[i].style.borderColor = '';
                }
                var enterButton = document.getElementById('enterButton');
                enterButton.style.display = 'none';
                enterButton.textContent = 'Enter';
                enterButton.style.backgroundColor = '#007bff';
            }
            draggedTile = null;
            console.log('Drag state reset');
        }

        window.addEventListener('dragend', function(e) {
            if (e.target.classList.contains('png-tile')) {
                setTimeout(function() {
                    if (!document.querySelector('.circle-drop-zone.drag-over')) {
                        resetDragState();
                    }
                }, 100);
            }
        });

        window.addEventListener('resize', function() {
            createCircularLayout();
            attachDropZoneListeners();
        });

        window.addEventListener('load', function() {
            try {
                initializeGame();
                console.log('Circular game initialized successfully');
            } catch (error) {
                console.error('Error initializing game:', error);
            }
        });
    </script>
</body>
</html>